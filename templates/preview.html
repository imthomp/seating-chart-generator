<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview Seating Chart</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        {% set colors = [
            ('#e3f2fd', '#64b5f6'),
            ('#e8f5e9', '#81c784'),
            ('#fff3e0', '#ffb74d'),
            ('#ffebee', '#e57373'),
            ('#f3e5f5', '#ba68c8'),
            ('#e0f7fa', '#4dd0e1'),
            ('#fce4ec', '#f06292'),
            ('#e8eaf6', '#7986cb')
        ] %}
        {% for part in part_order %}
        {% set color = colors[loop.index0 % colors|length] %}
        .seat.part-{{ loop.index0 }} {
            background-color: {{ color[0] }};
            border-color: {{ color[1] }};
        }
        .legend-color.part-{{ loop.index0 }} {
            background-color: {{ color[0] }};
            border-color: {{ color[1] }};
        }
        {% endfor %}

        /* Stagger: half of (seat width + gap) = (120 + 8) / 2 = 64px */
        .chart-container.staggered .chart-row.stagger-offset {
            transform: translateX(64px);
        }
        /* Keep row labels aligned when staggered */
        .chart-container.staggered .chart-row.stagger-offset .row-label {
            transform: translateX(-64px);
        }

        /* Seat position numbers */
        .seat {
            position: relative;
        }
        .seat-number {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 0.6rem;
            color: #9ca3af;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>Preview Seating Chart</h1>
            <p class="subtitle">{{ num_singers }} singers | {{ rows }} rows | {{ layout }} layout</p>
        </div>

        <div class="chart-wrapper{% if flipped %} flipped{% endif %}">
            <div class="chart-container{% if staggered %} staggered{% endif %}">
                {% for row in chart %}
                    <div class="chart-row{% if stagger_offsets[loop.index0] %} stagger-offset{% endif %}">
                        <span class="row-label">Row {{ loop.revindex }}</span>
                        {% for seat in row %}
                            {% if seat.singer %}
                                {% set part_idx = part_order.index(seat.singer.voice_part) if seat.singer.voice_part in part_order else 0 %}
                                <div class="seat part-{{ part_idx }}">
                                    <span class="seat-number">{{ loop.index }}</span>
                                    <span class="singer-name">{{ seat.singer.name }}</span>
                                    <span class="singer-info">{{ seat.singer.voice_part }} | {{ seat.singer.height_display }}</span>
                                </div>
                            {% else %}
                                <div class="seat empty">
                                    <span class="seat-number">{{ loop.index }}</span>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
            <div class="stage-label">STAGE / CONDUCTOR</div>
        </div>

        <div class="legend">
            <h3>Legend</h3>
            <div class="legend-items">
                {% for part in part_order %}
                <div class="legend-item">
                    <span class="legend-color part-{{ loop.index0 }}"></span>
                    <span>{{ part }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="actions">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Start Over</a>

            <form action="{{ url_for('edit') }}" method="post" style="display: contents;">
                <input type="hidden" name="chart_data" value="{{ chart_data }}">
                <input type="hidden" name="singers_data" value="{{ singers_data }}">
                <input type="hidden" name="part_order" value="{{ part_order | join(', ') }}">
                <input type="hidden" name="layout" value="{{ layout }}">
                <input type="hidden" name="num_singers" value="{{ num_singers }}">
                <input type="hidden" name="flipped" value="{{ 'true' if flipped else 'false' }}">
                <input type="hidden" name="staggered" value="{{ 'true' if staggered else 'false' }}">
                <button type="submit" class="btn btn-primary">Edit Chart</button>
            </form>

            <form action="{{ url_for('finalize') }}" method="post" style="display: contents;">
                <input type="hidden" name="chart_data" value="{{ chart_data }}">
                <input type="hidden" name="singers_data" value="{{ singers_data }}">
                <input type="hidden" name="part_order" value="{{ part_order | join(', ') }}">
                <input type="hidden" name="layout" value="{{ layout }}">
                <input type="hidden" name="num_singers" value="{{ num_singers }}">
                <input type="hidden" name="flipped" value="{{ 'true' if flipped else 'false' }}">
                <input type="hidden" name="staggered" value="{{ 'true' if staggered else 'false' }}">
                <button type="submit" class="btn btn-success">Looks Good</button>
            </form>
        </div>
    </div>
</body>
</html>